# dimabot

Телеграм‑бот для пошагового онбординга пользователей. Репозиторий содержит
исходный код бота, тесты, а также инструкции по развёртыванию с помощью Docker и
systemd.

## Возможности

- Команда `/start` запускает последовательность шагов с подсказками.
- Кнопки внутри сообщений позволяют переходить к следующему шагу.
- На последнем шаге бот отправляет финальную ссылку, задаваемую через
  переменную окружения.
- Ошибки логируются и, при наличии `DIMABOT_ADMIN_CHAT_ID`, бот пытается
  уведомить администратора.

## Быстрый старт

1. Склонируйте репозиторий и установите зависимости:

   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements-dev.txt
   ```

2. Создайте файл `.env` с параметрами подключения:

   ```dotenv
   DIMABOT_TOKEN=123456789:ABCDEF_your_token
   DIMABOT_FINAL_LINK=https://example.org/final
   # DIMABOT_ADMIN_CHAT_ID=123456789  # необязательно
   ```

3. Запустите бота локально:

   ```bash
   python -m bot.main
   ```

4. Откройте тестовый чат с ботом и пройдите путь от `/start` до финальной
   ссылки, убеждаясь что кнопки работают и ссылка отображается корректно.

## Тестирование

```bash
pytest
```

Юнит‑тесты проверяют корректность конфигурации и логики шагов.

## Конфигурация окружения

| Переменная                | Назначение                                                        |
|---------------------------|-------------------------------------------------------------------|
| `DIMABOT_TOKEN`           | Telegram Bot API token.                                           |
| `DIMABOT_FINAL_LINK`      | Ссылка, которую бот отправляет после прохождения шагов.           |
| `DIMABOT_ADMIN_CHAT_ID`   | Необязательный chat id для уведомлений об ошибках.               |

## Docker

Для развёртывания в контейнере можно использовать подготовленный `Dockerfile` и
`docker-compose.yml`.

```bash
docker compose up --build -d
```

Переменные окружения можно задать в `.env` (он автоматически подхватится
`docker compose`). Контейнер перезапускается при сбоях благодаря политике
`restart: unless-stopped`.

## systemd

Для bare‑metal или VPS можно использовать unit‑файл `systemd/dimabot.service`.

1. Скопируйте файл в `/etc/systemd/system/dimabot.service` и при необходимости
   скорректируйте пути.
2. Создайте файл окружения `/etc/dimabot.env` с переменными из таблицы выше.
3. Запустите и включите автозапуск:

   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable --now dimabot.service
   ```

systemd автоматически перезапустит бот при сбоях и сохраняет логи через journal.

## Структура репозитория

- `bot/` — исходный код бота.
- `tests/` — юнит‑тесты.
- `Dockerfile`, `docker-compose.yml` — инфраструктура для контейнеризации.
- `systemd/dimabot.service` — пример unit‑файла для systemd.
- `requirements*.txt` — списки зависимостей для разработки и рантайма.
- `pyproject.toml` — метаданные проекта.
